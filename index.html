<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 1</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style>
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">
    const config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 300 },
                debug: false
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    const game = new Phaser.Game(config);

    function preload () {
        this.load.image('sky', 'assets/sky.png');
        this.load.image('ground', 'assets/platform.png');
        this.load.image('star', 'assets/star.png');
        this.load.spritesheet('dude',
            'assets/dude.png',
            { frameWidth: 28, frameHeight: 35 }
        );
        this.load.audio('music', 'assets/music.wav');
    }

    let platforms, stars, player;

    let score = 0, starValue = 10;
    let scoreText;

    let addStar, makeBigger, improveStarValue;

    let music

    function create () {
        this.add.image(400, 300, 'sky'); // Background

        // Floors
        platforms = this.physics.add.staticGroup();

        platforms.create(400, 568, 'ground').setScale(2).refreshBody();

        // Player
        player = this.physics.add.sprite(100, 500, 'dude');
        player.setCollideWorldBounds(true);

        this.anims.create({
            key: 'right',
            frames: this.anims.generateFrameNumbers('dude', { start: 1, end: 4 }),
            frameRate: 5,
            repeat: -1
        });

        this.physics.add.collider(player, platforms);

        // Stars
        stars = this.physics.add.group({
            key: 'star',
            repeat: 4,
            setXY: { x: 0, y: 520, stepX: 200 }
        });

        // Make stars scroll to the left
        stars.children.iterate(function (child) {
            child.setVelocityX(-(Math.random() + 0.5) * 100);
            child.setBounce(Math.random());
        });

        this.physics.add.collider(stars, platforms);

        function collectStar(player, star) {
            star.x = 800;
            star.y = star.y - Math.random() * 600;
            star.setVelocityX(-(Math.random() + 0.5) * 200);
            star.setBounce(Math.random());

            score += starValue;
            scoreText.setText('Star points: ' + score);
        }

        this.physics.add.overlap(player, stars, collectStar, null, this);

        // Score text
        scoreText = this.add.text(16, 16, 'Star points: 0', {fontSize: '32px', fill: '#000'});

        // "Add star" button
        addStar = this.add.text(400, 100, 'Add stars\n(100 points each)', {fontSize: '32px', fill: '#000'});
        addStar.setInteractive();
        addStar.visible = false;

        // "Make bigger" button
        makeBigger = this.add.text(400, 250, 'Make player bigger\n (500 points)', {fontSize: '32px', fill: '#000'});
        makeBigger.setInteractive();
        makeBigger.visible = false;

        // "Improve star value" button
        improveStarValue = this.add.text(400, 400, 'Double star value\n (1000 points)', {fontSize: '32px', fill: '#000'});
        improveStarValue.setInteractive();
        improveStarValue.visible = false;

        // Music
        music = this.sound.add('music');
        music.setLoop(true);
        music.play();
    }

    function update () {
        player.anims.play('right', true); // Make it seem like the player is moving

        this.input.on('pointerdown', function() {
            if (!player.body.touching.down) return;
            player.setVelocityY(-300);
        });

        this.input.on('pointerup', function() { player.setVelocityY(0); });

        stars.children.iterate(function (child) {
            if (child.x <= 0) {
                child.x = 800;
                child.y = child.y - Math.random() * 600;
                child.setVelocityX(-(Math.random() + 0.5) * 200);
                child.setBounce(Math.random());
            }
        });

        // "Add star" button logic
        if (score >= 100) {
            addStar.visible = true;
            addStar.on('pointerdown', function() {
                if (score < 100) return; // Avoid bounce back
                let star = stars.create(800, 0, 'star');

                star.x = 800;
                star.y = star.y - Math.random() * 600;
                star.setVelocityX(-(Math.random() + 0.5) * 200);
                star.setBounce(Math.random());

                score -= 100;
                scoreText.setText('Star points: ' + score);
            });
        } else {
            addStar.visible = false;
            addStar.off('pointerdown');
        }

        // "Make bigger" button logic
        if (score >= 500) {
            makeBigger.visible = true;
            makeBigger.on('pointerdown', function() {
                if (score < 500) return; // Avoid bounce back
                player.setScale(player.scaleX * 1.2, player.scaleY * 1.2);
                score -= 500;
                scoreText.setText('Star points: ' + score);
            });
        } else {
            makeBigger.visible = false;
            makeBigger.off('pointerdown');
        }

        // "Improve star value" button logic
        if (score >= 1000) {
            improveStarValue.visible = true;
            improveStarValue.on('pointerdown', function() {
                if (score < 1000) return; // Avoid bounce back
                starValue *= 2;
                score -= 1000;
                scoreText.setText('Star points: ' + score);
            });
        } else {
            improveStarValue.visible = false;
            improveStarValue.off('pointerdown');
        }
    }

</script>

</body>
</html>